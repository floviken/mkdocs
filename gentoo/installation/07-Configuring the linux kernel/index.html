
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://floviken.github.io/mkdocs/gentoo/installation/07-Configuring%20the%20linux%20kernel/">
      
      
        <link rel="prev" href="../06-Installing%20the%20Gentoo%20base%20system/">
      
      
        <link rel="next" href="../08-Configuring%20the%20system/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.1, mkdocs-material-9.1.21">
    
    
      
        <title>Configuring the Linux kernel - KaboliDocs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.eebd395e.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Configuring the Linux kernel - KaboliDocs" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="https://floviken.github.io/mkdocs/assets/images/social/gentoo/installation/07-Configuring the linux kernel.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://floviken.github.io/mkdocs/gentoo/installation/07-Configuring%20the%20linux%20kernel/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Configuring the Linux kernel - KaboliDocs" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="https://floviken.github.io/mkdocs/assets/images/social/gentoo/installation/07-Configuring the linux kernel.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#configuring-the-linux-kernel" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="KaboliDocs" class="md-header__button md-logo" aria-label="KaboliDocs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            KaboliDocs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Configuring the Linux kernel
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="orange" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      Welcome to MkDocs
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../ssh/" class="md-tabs__link">
      SSH setup
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link md-tabs__link--active">
        Gentoo
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="KaboliDocs" class="md-nav__button md-logo" aria-label="KaboliDocs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    KaboliDocs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Welcome to MkDocs
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../ssh/" class="md-nav__link">
        SSH setup
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Gentoo
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Gentoo
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        gentoo handbook
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../01-About%20the%20Gentoo%20Linux%20Installation/" class="md-nav__link">
        About the Gentoo Linux Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../010-Configuring%20the%20bootloader/" class="md-nav__link">
        Configuring the bootloader
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../02-Choosing%20the%20right%20installation%20medium/" class="md-nav__link">
        Choosing the right installation medium
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../03-Configuring%20the%20network/" class="md-nav__link">
        Configuring the network
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../04-Preparing%20the%20disks/" class="md-nav__link">
        Preparing the disks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05-Installing%20the%20Gentoo%20installation%20files/" class="md-nav__link">
        Installing the Gentoo installation files
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../06-Installing%20the%20Gentoo%20base%20system/" class="md-nav__link">
        Installing the Gentoo base system
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Configuring the Linux kernel
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Configuring the Linux kernel
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#optional-installing-firmware-andor-microcode" class="md-nav__link">
    Optional: Installing firmware and/or microcode
  </a>
  
    <nav class="md-nav" aria-label="Optional: Installing firmware and/or microcode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#firmware" class="md-nav__link">
    Firmware
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#microcode" class="md-nav__link">
    Microcode
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kernel-configuration-and-compilation" class="md-nav__link">
    Kernel configuration and compilation
  </a>
  
    <nav class="md-nav" aria-label="Kernel configuration and compilation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#distribution-kernels" class="md-nav__link">
    Distribution kernels
  </a>
  
    <nav class="md-nav" aria-label="Distribution kernels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-the-correct-installkernel-package" class="md-nav__link">
    Installing the correct installkernel package
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-a-distribution-kernel" class="md-nav__link">
    Installing a distribution kernel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upgrading-and-cleaning-up" class="md-nav__link">
    Upgrading and cleaning up
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-installupgrade-tasks" class="md-nav__link">
    Post-install/upgrade tasks
  </a>
  
    <nav class="md-nav" aria-label="Post-install/upgrade tasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manually-rebuilding-the-initramfs" class="md-nav__link">
    Manually rebuilding the initramfs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-the-kernel-sources" class="md-nav__link">
    Installing the kernel sources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternative-genkernel" class="md-nav__link">
    Alternative: Genkernel
  </a>
  
    <nav class="md-nav" aria-label="Alternative: Genkernel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#binary-redistributable-software-license-group" class="md-nav__link">
    Binary redistributable software license group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generation" class="md-nav__link">
    Generation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternative-manual-configuration" class="md-nav__link">
    Alternative: Manual configuration
  </a>
  
    <nav class="md-nav" aria-label="Alternative: Manual configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enabling-required-options" class="md-nav__link">
    Enabling required options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enabling-support-for-typical-system-components" class="md-nav__link">
    Enabling support for typical system components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#architecture-specific-kernel-configuration" class="md-nav__link">
    Architecture specific kernel configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compiling-and-installing" class="md-nav__link">
    Compiling and installing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-building-an-initramfs" class="md-nav__link">
    Optional: Building an initramfs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kernel-modules" class="md-nav__link">
    Kernel modules
  </a>
  
    <nav class="md-nav" aria-label="Kernel modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listing-available-kernel-modules" class="md-nav__link">
    Listing available kernel modules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#force-loading-particular-kernel-modules" class="md-nav__link">
    Force loading particular kernel modules
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../08-Configuring%20the%20system/" class="md-nav__link">
        Configuring the system
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../09-Installing%20system%20tools/" class="md-nav__link">
        Installing system tools
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          Working with gentoo
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Working with gentoo
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../working_with_gentoo/01-Portage/" class="md-nav__link">
        Working with Gentoo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../working_with_gentoo/02-Use/" class="md-nav__link">
        What are USE flags
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../working_with_gentoo/03-Features/" class="md-nav__link">
        Portage features
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../working_with_gentoo/04-Initscripts/" class="md-nav__link">
        Runlevels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../working_with_gentoo/05-EnvVar/" class="md-nav__link">
        Environment variables
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4" >
      
      
      
        <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
          Working with portage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Working with portage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../working_with_portage/01-Files/" class="md-nav__link">
        01 Files
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="configuring-the-linux-kernel">Configuring the Linux kernel</h1>
<h2 id="optional-installing-firmware-andor-microcode">Optional: Installing firmware and/or microcode</h2>
<h3 id="firmware">Firmware</h3>
<p>Before getting to configuring kernel sections, it is beneficial to be aware that some hardware devices require additional, sometimes non-FOSS compliant, firmware to be installed on the system before they will operate correctly. This is often the case for wireless network interfaces commonly found in both desktop and laptop computers. Modern video chips from vendors like AMD, Nvidia, and Intel, often also require external firmware files to be fully functional. Most firmware for modern hardware devices can be found within the <a href="https://packages.gentoo.org/packages/sys-kernel/linux-firmware">sys-kernel/linux-firmware</a> package.</p>
<p>It is recommended to have the <a href="https://packages.gentoo.org/packages/sys-kernel/linux-firmware">sys-kernel/linux-firmware</a> package installed before the initial system reboot in order to have the firmware available in the event that it is necessary:</p>
<p><code>root # emerge --ask sys-kernel/linux-firmware</code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>Installing certain firmware packages often requires accepting the associated firmware licenses. If necessary, visit the license handling section of the Handbook for help on accepting licenses.</p>
<p>It is important to note that kernel symbols that are built as modules (M) will load their associated firmware files from the filesystem when they are loaded by the kernel. It is not necessary to include the device's firmware files into the kernel's binary image for symbols loaded as modules.</p>
<h3 id="microcode">Microcode</h3>
<p>In addition to discrete graphics hardware and network interfaces, CPUs also can require firmware updates. Typically this kind of firmware is referred to as microcode. Newer revisions of microcode are sometimes necessary to patch instability, security concerns, or other miscellaneous bugs in CPU hardware.</p>
<p>Microcode updates for AMD CPUs are distributed within the aforementioned <a href="https://packages.gentoo.org/packages/sys-kernel/linux-firmware">sys-kernel/linux-firmware</a> package. Microcode for Intel CPUs can be found within the <a href="https://packages.gentoo.org/packages/sys-firmware/intel-microcode">sys-firmware/intel-microcode</a> package, which will need to be installed separately. See the <a href="https://wiki.gentoo.org/wiki/Microcode">Microcode article</a> for more information on how to apply microcode updates.</p>
<h2 id="kernel-configuration-and-compilation">Kernel configuration and compilation</h2>
<p>Now it is time to configure and compile the kernel sources. For the purposes of the installation, three approaches to kernel management will be presented, however at any point post-installation a new approach can be employed.</p>
<p>Ranked from least involved to most involved:</p>
<p><a href="#distribution-kernels">Full automation approach: Distribution kernels</a></p>
<p>A <a href="https://wiki.gentoo.org/wiki/Project:Distribution_Kernel">Distribution Kernel</a> is used to configure, automatically build, and install the Linux kernel, its associated modules, and (optionally, but enabled by default) an initramfs file. Future kernel updates are fully automated since they are handled through the package manager, just like any other system package. It is possible provide <a href="https://wiki.gentoo.org/wiki/Project:Distribution_Kernel">a custom kernel configuration file</a> if customization is necessary. This is the least involved process and is perfect for new Gentoo users due to it working out-of-the-box and offering minimal involvement from the system administrator.</p>
<p><a href="#alternative-genkernel">Hybrid approach: Genkernel</a></p>
<p>New kernel sources are installed via the system package manager. System administrators use Gentoo's <strong>genkernel</strong> tool to generically configure, automatically build and install the Linux kernel, its associated modules, and (optionally, but <strong>not</strong> enabled by default) an initramfs file. It is possible provide a custom kernel configuration file if customization is necessary. Future kernel configuration, compilation, and installation require the system administrator's involvement in the form of running <strong>eselect kernel, genkernel</strong>, and potentially other commands for each update.</p>
<p><a href="#alternative-manual-configuration">Full manual approach</a></p>
<p>New kernel sources are installed via the system package manager. The kernel is manually configured, built, and installed using the <strong>eselect kernel</strong> and a slew of <strong>make</strong> commands. Future kernel updates repeat the manual process of configuring, building, and installing the kernel files. This is the most involved process, but offers maximum control over the kernel update process.
The core around which all distributions are built is the Linux kernel. It is the layer between the user's programs and the system hardware. Although the handbook provides its users several possible kernel sources, a more comprehensive listing with more detailed descriptions is available at the <a href="https://wiki.gentoo.org/wiki/Kernel/Overview">Kernel overview page</a>.</p>
<h3 id="distribution-kernels">Distribution kernels</h3>
<p><a href="https://wiki.gentoo.org/wiki/Project:Distribution_Kernel">Distribution Kernels</a> are ebuilds that cover the complete process of unpacking, configuring, compiling, and installing the kernel. The primary advantage of this method is that the kernels are updated to new versions by the package manager as part of @world upgrade. This requires no more involvement than running an emerge command. Distribution kernels default to a configuration supporting the majority of hardware, however two mechanisms are offered for customization: savedconfig and config snippets. See the project page for <a href="https://wiki.gentoo.org/wiki/Project:Distribution_Kernel#Modifying_kernel_configuration">more details on configuration</a>.</p>
<h4 id="installing-the-correct-installkernel-package">Installing the correct installkernel package</h4>
<p>Before using the distribution kernels, please verify that the correct installkernel package for the system has been installed. When using <a href="https://wiki.gentoo.org/wiki/Systemd-boot">systemd-boot</a> (formerly gummiboot) as the bootloader, install:</p>
<p><code>root # emerge --ask sys-kernel/installkernel-systemd-boot</code></p>
<p>When using a traditional a /boot layout (e.g. GRUB, LILO, etc.), the <em>gentoo</em> variant should be installed by default. If in doubt:</p>
<p><code>root # emerge --ask sys-kernel/installkernel-gentoo</code></p>
<h4 id="installing-a-distribution-kernel">Installing a distribution kernel</h4>
<p>To build a kernel with Gentoo patches from source, type:</p>
<p><code>root # emerge --ask sys-kernel/gentoo-kernel</code></p>
<p>System administrators who want to avoid compiling the kernel sources locally can instead use precompiled kernel images:</p>
<p><code>root # emerge --ask sys-kernel/gentoo-kernel-bin</code></p>
<h4 id="upgrading-and-cleaning-up">Upgrading and cleaning up</h4>
<p>Once the kernel is installed, the package manager will automatically update it to newer versions. The previous versions will be kept until the package manager is requested to clean up stale packages. To reclaim disk space, stale packages can be trimmed by periodically running emerge with the --depclean option:</p>
<p><code>root # emerge --depclean</code></p>
<p>Alternatively, to specifically clean up old kernel versions:</p>
<p><code>root # emerge --prune sys-kernel/gentoo-kernel sys-kernel/gentoo-kernel-bin</code></p>
<h4 id="post-installupgrade-tasks">Post-install/upgrade tasks</h4>
<p>Distribution kernels are capable of rebuilding kernel modules installed by other packages. linux-mod.eclass provides the <code>dist-kernel</code> USE flag which controls a subslot dependency on <a href="https://packages.gentoo.org/packages/virtual/dist-kernel">virtual/dist-kernel</a>.</p>
<p>Enabling this USE flag on packages like <a href="https://packages.gentoo.org/packages/sys-fs/zfs">sys-fs/zfs</a> and <a href="https://packages.gentoo.org/packages/sys-fs/zfs-kmod">sys-fs/zfs-kmod</a> allows them to automatically be rebuilt against a newly updated kernel and, if applicable, will re-generate the initramfs accordingly.</p>
<h5 id="manually-rebuilding-the-initramfs">Manually rebuilding the initramfs</h5>
<p>If required, manually trigger such rebuilds by, after a kernel upgrade, executing:</p>
<p><code>root # emerge --ask @module-rebuild</code></p>
<p>If any kernel modules (e.g. ZFS) are needed at early boot, rebuild the initramfs afterward via:</p>
<p><code>root # emerge --config sys-kernel/gentoo-kernel</code>
<code>root # emerge --config sys-kernel/gentoo-kernel-bin</code></p>
<h3 id="installing-the-kernel-sources">Installing the kernel sources</h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>This section is only relevant when using the following genkernel (hybrid) or manual kernel management approach.
When installing and compiling the kernel for amd64-based systems, Gentoo recommends the sys-kernel/gentoo-sources package.</p>
<p>Choose an appropriate kernel source and install it using <strong>emerge</strong>:</p>
<p><code>root # emerge --ask sys-kernel/gentoo-sources</code></p>
<p>This will install the Linux kernel sources in /usr/src/ using the specific kernel version in the path. It will not create a symbolic link by itself without <code>USE=symlink</code> being enabled on the chosen kernel sources package.</p>
<p>It is conventional for a /usr/src/linux symlink to be maintained, such that it refers to whichever sources correspond with the currently running kernel. However, this symbolic link will not be created by default. An easy way to create the symbolic link is to utilize eselect's kernel module.</p>
<p>For further information regarding the purpose of the symlink, and how to manage it, please refer to <a href="https://wiki.gentoo.org/wiki/Kernel/Upgrade">Kernel/Upgrade</a>.</p>
<p>First, list all installed kernels:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>root<span class="w"> </span><span class="c1"># eselect kernel list</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>Available<span class="w"> </span>kernel<span class="w"> </span>symlink<span class="w"> </span>targets:
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">  </span><span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w">   </span>linux-5.15.52-gentoo
</code></pre></div>
<p>In order to create a symbolic link called linux, use:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>root<span class="w"> </span>$<span class="w"> </span>eselect<span class="w"> </span>kernel<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>root<span class="w"> </span>$<span class="w"> </span>ls<span class="w"> </span>-l<span class="w"> </span>/usr/src/linux
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>lrwxrwxrwx<span class="w">    </span><span class="m">1</span><span class="w"> </span>root<span class="w">   </span>root<span class="w">    </span><span class="m">12</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">13</span><span class="w"> </span><span class="m">11</span>:04<span class="w"> </span>/usr/src/linux<span class="w"> </span>-&gt;<span class="w"> </span>linux-5.15.52-gentoo
</code></pre></div>
<h3 id="alternative-genkernel">Alternative: Genkernel</h3>
<p>If an entirely manual configuration looks too daunting, system administrators should consider using <a href="https://wiki.gentoo.org/wiki/Genkernel">genkernel</a> as a hybrid approach to kernel maintenance.</p>
<p>Genkernel provides a generic kernel configuration file, automatically <strong>gen</strong>erates the <strong>kernel</strong>, initramfs, and associated modules, and then installs the resulting binaries to the appropriate locations. This results in minimal and generic hardware support for the system's first boot, and allows for additional update control and customization of the kernel's configuration in the future.</p>
<p>Be informed: while using <strong>genkernel</strong> to maintain the kernel provides system administrators with more update control over the system's kernel, initramfs, and other options, it will require a time and effort commitment to perform future kernel updates as new sources are released. Those looking for a hands-off approach to kernel maintenance should <a href="https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Kernel#Alternative:_Using_distribution_kernels">use a distribution kernel</a>.</p>
<p>For additional clarity, it is a <em>misconception</em> to believe genkernel automatically generates a custom kernel configuration for the hardware on which it is run; it uses a predetermined kernel configuration that supports most generic hardware and automatically handles the <strong>make</strong> commands necessary to assemble and install the kernel, the associate modules, and the initramfs file.</p>
<h4 id="binary-redistributable-software-license-group">Binary redistributable software license group</h4>
<p>If the linux-firmware package has been previously installed, then skip onward to the to the <a href="#installation">installation section</a>.</p>
<p>As a prerequisite, due to the <code>firwmare</code> USE flag being enabled by default for the <a href="https://packages.gentoo.org/packages/sys-kernel/genkernel">sys-kernel/genkernel</a> package, the package manager will also attempt to pull in the <a href="https://packages.gentoo.org/packages/sys-kernel/linux-firmware">sys-kernel/linux-firmware</a> package. The binary redistributable software licenses are required to be accepted before the linux-firmware will install.</p>
<p>This license group can be accepted system-wide for any package by adding the <code>@BINARY-REDISTRIBUTABLE</code> as an <em>ACCEPT_LICENSE</em> value in the /etc/portage/make.conf file. It can be exclusively accepted for the linux-firmware package by adding a specific inclusion via a /etc/portage/package.license/linux-firmware file.</p>
<p>If necessary, review the <a href="https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Base#Optional:_Configure_the_ACCEPT_LICENSE_variable">methods of accepting software licenses</a> available in the Installing the base system chapter of the handbook, then make some changes for acceptable software licenses.</p>
<p>If in analysis paralysis, the following will do the trick:</p>
<p><code>root # mkdir /etc/portage/package.license</code></p>
<div class="highlight"><span class="filename">FILE /etc/portage/package.license/linux-firmware Accept binary redistributable licenses for the linux-firmware package</span><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>sys-kernel/linux-firmware<span class="w"> </span>@BINARY-REDISTRIBUTABLE
</code></pre></div>
<h4 id="installation">Installation</h4>
<p>Explanations and prerequisites aside, install the sys-kernel/genkernel package:</p>
<p><code>root # emerge --ask sys-kernel/genkernel</code></p>
<h4 id="generation">Generation</h4>
<p>Compile the kernel sources by running <strong>genkernel all</strong>. Be aware though, as <strong>genkernel</strong> compiles a kernel that supports a wide array of hardware for differing computer architectures, this compilation may take quite a while to finish.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>If the root partition/volume uses a filesystem other than ext4, it may be necessary to manually configure the kernel using genkernel --menuconfig all to add built-in kernel support for the particular filesystem(s) (i.e. not building the filesystem as a module).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>Users of LVM2 should add --lvm as an argument to the genkernel command below.</p>
<p><code>root # genkernel --mountboot --install all</code></p>
<p>Once genkernel completes, a kernel and an initial ram filesystem (initramfs) will be generated and installed into the /boot directory. Associated modules will be installed into the /lib/modules directory. The initramfs will be started immediately after loading the kernel to perform hardware auto-detection (just like in the live disk image environments).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>root<span class="w"> </span><span class="c1"># ls /boot/vmlinu* /boot/initramfs*</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>root<span class="w"> </span><span class="c1"># ls /lib/modules</span>
</code></pre></div>
<h3 id="alternative-manual-configuration">Alternative: Manual configuration</h3>
<h4 id="introduction">Introduction</h4>
<p>Manually configuring a kernel is often seen as the most difficult procedure a Linux user ever has to perform. Nothing is less true - after configuring a couple of kernels no one remembers that it was difficult!</p>
<p>However, one thing is true: it is vital to know the system when a kernel is configured manually. Most information can be gathered by emerging <a href="https://packages.gentoo.org/packages/sys-apps/pciutils">sys-apps/pciutils</a> which contains the <strong>lspci</strong> command:</p>
<p><code>root # emerge --ask sys-apps/pciutils</code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>Inside the chroot, it is safe to ignore any pcilib warnings (like pcilib: cannot open /sys/bus/pci/devices) that <strong>lspci</strong> might throw out.</p>
<p>Another source of system information is to run <strong>lsmod</strong> to see what kernel modules the installation CD uses as it might provide a nice hint on what to enable.</p>
<p>Now go to the kernel source directory and execute <strong>make menuconfig</strong>. This will fire up menu-driven configuration screen.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>root<span class="w"> </span><span class="c1"># cd /usr/src/linux</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>root<span class="w"> </span><span class="c1"># make menuconfig</span>
</code></pre></div>
<p>The Linux kernel configuration has many, many sections. Let's first list some options that must be activated (otherwise Gentoo will not function, or not function properly without additional tweaks). We also have a <a href="https://wiki.gentoo.org/wiki/Kernel/Gentoo_Kernel_Configuration_Guide">Gentoo kernel configuration guide</a> on the Gentoo wiki that might help out further.</p>
<h4 id="enabling-required-options">Enabling required options</h4>
<p>When using <a href="https://packages.gentoo.org/packages/sys-kernel/gentoo-sources">sys-kernel/gentoo-sources</a>, it is strongly recommend the Gentoo-specific configuration options be enabled. These ensure that a minimum of kernel features required for proper functioning is available:</p>
<div class="highlight"><span class="filename">KERNEL Enabling Gentoo-specific options</span><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>Gentoo<span class="w"> </span>Linux<span class="w"> </span>---&gt;
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span>Generic<span class="w"> </span>Driver<span class="w"> </span>Options<span class="w"> </span>---&gt;
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Gentoo<span class="w"> </span>Linux<span class="w"> </span>support
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="o">[</span>*<span class="o">]</span><span class="w">   </span>Linux<span class="w"> </span>dynamic<span class="w"> </span>and<span class="w"> </span>persistent<span class="w"> </span>device<span class="w"> </span>naming<span class="w"> </span><span class="o">(</span>userspace<span class="w"> </span>devfs<span class="o">)</span><span class="w"> </span>support
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="o">[</span>*<span class="o">]</span><span class="w">   </span>Select<span class="w"> </span>options<span class="w"> </span>required<span class="w"> </span>by<span class="w"> </span>Portage<span class="w"> </span>features
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">        </span>Support<span class="w"> </span><span class="k">for</span><span class="w"> </span>init<span class="w"> </span>systems,<span class="w"> </span>system<span class="w"> </span>and<span class="w"> </span>service<span class="w"> </span>managers<span class="w">  </span>---&gt;
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">          </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>OpenRC,<span class="w"> </span>runit<span class="w"> </span>and<span class="w"> </span>other<span class="w"> </span>script<span class="w"> </span>based<span class="w"> </span>systems<span class="w"> </span>and<span class="w"> </span>managers
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">          </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>systemd
</code></pre></div>
<p>Naturally the choice in the last two lines depends on the selected init system (<a href="https://wiki.gentoo.org/wiki/OpenRC">OpenRC</a> vs. <a href="https://wiki.gentoo.org/wiki/Systemd">systemd</a>). It does not hurt to have support for both init systems enabled.</p>
<p>When using <a href="https://packages.gentoo.org/packages/sys-kernel/vanilla-sources">sys-kernel/vanilla-sources</a>, the additional selections for init systems will be unavailable. Enabling support is possible, but goes beyond the scope of the handbook.</p>
<h4 id="enabling-support-for-typical-system-components">Enabling support for typical system components</h4>
<p>Make sure that every driver that is vital to the booting of the system (such as SATA controllers, NVMe block device support, filesystem support, etc.) is compiled in the kernel and not as a module, otherwise the system may not be able to boot completely.</p>
<p>Next select the exact processor type. It is also recommended to enable MCE features (if available) so that users are able to be notified of any hardware problems. On some architectures (such as x86_64), these errors are not printed to <strong>dmesg</strong>, but to /dev/mcelog. This requires the <a href="https://packages.gentoo.org/packages/app-admin/mcelog">app-admin/mcelog</a> package.</p>
<p>Also select Maintain a devtmpfs file system to mount at /dev so that critical device files are already available early in the boot process (<em>CONFIG_DEVTMPFS</em> and <em>CONFIG_DEVTMPFS_MOUNT</em>):</p>
<div class="highlight"><span class="filename">KERNEL Enabling devtmpfs support (CONFIG_DEVTMPFS)</span><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>Device<span class="w"> </span>Drivers<span class="w"> </span>---&gt;
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span>Generic<span class="w"> </span>Driver<span class="w"> </span>Options<span class="w"> </span>---&gt;
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Maintain<span class="w"> </span>a<span class="w"> </span>devtmpfs<span class="w"> </span>filesystem<span class="w"> </span>to<span class="w"> </span>mount<span class="w"> </span>at<span class="w"> </span>/dev
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="o">[</span>*<span class="o">]</span><span class="w">   </span>Automount<span class="w"> </span>devtmpfs<span class="w"> </span>at<span class="w"> </span>/dev,<span class="w"> </span>after<span class="w"> </span>the<span class="w"> </span>kernel<span class="w"> </span>mounted<span class="w"> </span>the<span class="w"> </span>rootfs
</code></pre></div>
<p>Verify SCSI disk support has been activated (CONFIG_BLK_DEV_SD):</p>
<div class="highlight"><span class="filename">KERNEL Enabling SCSI disk support (CONFIG_SCSI, CONFIG_BLK_DEV_SD)</span><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>Device<span class="w"> </span>Drivers<span class="w"> </span>---&gt;
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">  </span>SCSI<span class="w"> </span>device<span class="w"> </span>support<span class="w">  </span>---&gt;<span class="w"> </span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span>&lt;*&gt;<span class="w"> </span>SCSI<span class="w"> </span>device<span class="w"> </span>support
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span>&lt;*&gt;<span class="w"> </span>SCSI<span class="w"> </span>disk<span class="w"> </span>support
</code></pre></div>
<div class="highlight"><span class="filename">KERNEL Enabling basic SATA and PATA support (CONFIG_ATA_ACPI, CONFIG_SATA_PMP, CONFIG_SATA_AHCI, CONFIG_ATA_BMDMA, CONFIG_ATA_SFF, CONFIG_ATA_PIIX)</span><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>Device<span class="w"> </span>Drivers<span class="w"> </span>---&gt;
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span>&lt;*&gt;<span class="w"> </span>Serial<span class="w"> </span>ATA<span class="w"> </span>and<span class="w"> </span>Parallel<span class="w"> </span>ATA<span class="w"> </span>drivers<span class="w"> </span><span class="o">(</span>libata<span class="o">)</span><span class="w">  </span>---&gt;
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>ATA<span class="w"> </span>ACPI<span class="w"> </span>Support
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>SATA<span class="w"> </span>Port<span class="w"> </span>Multiplier<span class="w"> </span>support
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span>&lt;*&gt;<span class="w"> </span>AHCI<span class="w"> </span>SATA<span class="w"> </span>support<span class="w"> </span><span class="o">(</span>ahci<span class="o">)</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>ATA<span class="w"> </span>BMDMA<span class="w"> </span>support
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>ATA<span class="w"> </span>SFF<span class="w"> </span>support<span class="w"> </span><span class="o">(</span><span class="k">for</span><span class="w"> </span>legacy<span class="w"> </span>IDE<span class="w"> </span>and<span class="w"> </span>PATA<span class="o">)</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span>&lt;*&gt;<span class="w"> </span>Intel<span class="w"> </span>ESB,<span class="w"> </span>ICH,<span class="w"> </span>PIIX3,<span class="w"> </span>PIIX4<span class="w"> </span>PATA/SATA<span class="w"> </span>support<span class="w"> </span><span class="o">(</span>ata_piix<span class="o">)</span>
</code></pre></div>
<p>Verify basic NVMe support has been enabled:</p>
<div class="highlight"><span class="filename">KERNEL Enable basic NVMe support for Linux 4.4.x (CONFIG_BLK_DEV_NVME)</span><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>Device<span class="w"> </span>Drivers<span class="w">  </span>---&gt;
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span>&lt;*&gt;<span class="w"> </span>NVM<span class="w"> </span>Express<span class="w"> </span>block<span class="w"> </span>device
</code></pre></div>
<p><div class="highlight"><span class="filename">KERNEL Enable basic NVMe support for Linux 5.x.x (CONFIG_DEVTMPFS)</span><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>Device<span class="w"> </span>Drivers<span class="w"> </span>---&gt;
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span>NVME<span class="w"> </span>Support<span class="w"> </span>---&gt;
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span>&lt;*&gt;<span class="w"> </span>NVM<span class="w"> </span>Express<span class="w"> </span>block<span class="w"> </span>device
</code></pre></div>
It does not hurt to enable the following additional NVMe support:</p>
<div class="highlight"><span class="filename">KERNEL Enabling additional NVMe support (CONFIG_NVME_MULTIPATH, CONFIG_NVME_MULTIPATH, CONFIG_NVME_HWMON, CONFIG_NVME_FC, CONFIG_NVME_TCP, CONFIG_NVME_TARGET, CONFIG_NVME_TARGET_PASSTHRU, CONFIG_NVME_TARGET_LOOP, CONFIG_NVME_TARGET_FC, CONFIG_NVME_TARGET_FCLOOP, CONFIG_NVME_TARGET_TCP</span><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>NVMe<span class="w"> </span>multipath<span class="w"> </span>support
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>NVMe<span class="w"> </span>hardware<span class="w"> </span>monitoring
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>&lt;M&gt;<span class="w"> </span>NVM<span class="w"> </span>Express<span class="w"> </span>over<span class="w"> </span>Fabrics<span class="w"> </span>FC<span class="w"> </span>host<span class="w"> </span>driver
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>&lt;M&gt;<span class="w"> </span>NVM<span class="w"> </span>Express<span class="w"> </span>over<span class="w"> </span>Fabrics<span class="w"> </span>TCP<span class="w"> </span>host<span class="w"> </span>driver
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>&lt;M&gt;<span class="w"> </span>NVMe<span class="w"> </span>Target<span class="w"> </span>support
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">  </span><span class="o">[</span>*<span class="o">]</span><span class="w">   </span>NVMe<span class="w"> </span>Target<span class="w"> </span>Passthrough<span class="w"> </span>support
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">  </span>&lt;M&gt;<span class="w">   </span>NVMe<span class="w"> </span>loopback<span class="w"> </span>device<span class="w"> </span>support
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">  </span>&lt;M&gt;<span class="w">   </span>NVMe<span class="w"> </span>over<span class="w"> </span>Fabrics<span class="w"> </span>FC<span class="w"> </span>target<span class="w"> </span>driver
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">  </span>&lt;<span class="w"> </span>&gt;<span class="w">     </span>NVMe<span class="w"> </span>over<span class="w"> </span>Fabrics<span class="w"> </span>FC<span class="w"> </span>Transport<span class="w"> </span>Loopback<span class="w"> </span>Test<span class="w"> </span>driver<span class="w"> </span><span class="o">(</span>NEW<span class="o">)</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">  </span>&lt;M&gt;<span class="w">   </span>NVMe<span class="w"> </span>over<span class="w"> </span>Fabrics<span class="w"> </span>TCP<span class="w"> </span>target<span class="w"> </span>support
</code></pre></div>
<p>Now go to File Systems and select support for the filesystems that will be used by the system. Do not compile the file system that is used for the root filesystem as module, otherwise the system may not be able to mount the partition. Also select <em>Virtual memory</em> and <em>/proc file system</em>. Select one or more of the following options as needed by the system:</p>
<div class="highlight"><span class="filename">KERNEL Enable file system support (CONFIG_EXT2_FS, CONFIG_EXT3_FS, CONFIG_EXT4_FS, CONFIG_BTRFS_FS, CONFIG_XFS_FS, CONFIG_MSDOS_FS, CONFIG_VFAT_FS, CONFIG_PROC_FS, and CONFIG_TMPFS)</span><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>File<span class="w"> </span>systems<span class="w"> </span>---&gt;
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">  </span>&lt;*&gt;<span class="w"> </span>Second<span class="w"> </span>extended<span class="w"> </span>fs<span class="w"> </span>support
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">  </span>&lt;*&gt;<span class="w"> </span>The<span class="w"> </span>Extended<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">(</span>ext3<span class="o">)</span><span class="w"> </span>filesystem
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">  </span>&lt;*&gt;<span class="w"> </span>The<span class="w"> </span>Extended<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">(</span>ext4<span class="o">)</span><span class="w"> </span>filesystem
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">  </span>&lt;*&gt;<span class="w"> </span>Btrfs<span class="w"> </span>filesystem<span class="w"> </span>support
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">  </span>&lt;*&gt;<span class="w"> </span>XFS<span class="w"> </span>filesystem<span class="w"> </span>support
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">  </span>DOS/FAT/NT<span class="w"> </span>Filesystems<span class="w">  </span>---&gt;
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">    </span>&lt;*&gt;<span class="w"> </span>MSDOS<span class="w"> </span>fs<span class="w"> </span>support
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">    </span>&lt;*&gt;<span class="w"> </span>VFAT<span class="w"> </span><span class="o">(</span>Windows-95<span class="o">)</span><span class="w"> </span>fs<span class="w"> </span>support
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">  </span>Pseudo<span class="w"> </span>Filesystems<span class="w"> </span>---&gt;
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">    </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>/proc<span class="w"> </span>file<span class="w"> </span>system<span class="w"> </span>support
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">    </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Tmpfs<span class="w"> </span>virtual<span class="w"> </span>memory<span class="w"> </span>file<span class="w"> </span>system<span class="w"> </span>support<span class="w"> </span><span class="o">(</span>former<span class="w"> </span>shm<span class="w"> </span>fs<span class="o">)</span>
</code></pre></div>
<p>If PPPoE is used to connect to the Internet, or a dial-up modem, then enable the following options (<em>CONFIG_PPP, CONFIG_PPP_ASYNC, and CONFIG_PPP_SYNC_TTY</em>):</p>
<div class="highlight"><span class="filename">KERNEL Enabling PPPoE support (PPPoE, CONFIG_PPPOE, CONFIG_PPP_ASYNC, CONFIG_PPP_SYNC_TTY</span><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>Device<span class="w"> </span>Drivers<span class="w"> </span>---&gt;
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span>Network<span class="w"> </span>device<span class="w"> </span>support<span class="w"> </span>---&gt;
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">    </span>&lt;*&gt;<span class="w"> </span>PPP<span class="w"> </span><span class="o">(</span>point-to-point<span class="w"> </span>protocol<span class="o">)</span><span class="w"> </span>support
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">    </span>&lt;*&gt;<span class="w"> </span>PPP<span class="w"> </span>over<span class="w"> </span>Ethernet
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">    </span>&lt;*&gt;<span class="w"> </span>PPP<span class="w"> </span>support<span class="w"> </span><span class="k">for</span><span class="w"> </span>async<span class="w"> </span>serial<span class="w"> </span>ports
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span>&lt;*&gt;<span class="w"> </span>PPP<span class="w"> </span>support<span class="w"> </span><span class="k">for</span><span class="w"> </span>sync<span class="w"> </span>tty<span class="w"> </span>ports
</code></pre></div>
<p>The two compression options won't harm but are not definitely needed, neither does the PPP over Ethernet option, that might only be used by ppp when configured to do kernel mode PPPoE.</p>
<p>Don't forget to include support in the kernel for the network (Ethernet or wireless) cards.</p>
<p>Most systems also have multiple cores at their disposal, so it is important to activate Symmetric multi-processing support (CONFIG_SMP):</p>
<div class="highlight"><span class="filename">KERNEL Activating SMP support (CONFIG_SMP)</span><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>Processor<span class="w"> </span><span class="nb">type</span><span class="w"> </span>and<span class="w"> </span>features<span class="w">  </span>---&gt;
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">  </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Symmetric<span class="w"> </span>multi-processing<span class="w"> </span>support
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>In multi-core systems, each core counts as one processor.
If USB input devices (like keyboard or mouse) or other USB devices will be used, do not forget to enable those as well:</p>
<div class="highlight"><span class="filename">KERNEL Enable USB and human input device support (CONFIG_HID_GENERIC, CONFIG_USB_HID, CONFIG_USB_SUPPORT, CONFIG_USB_XHCI_HCD, CONFIG_USB_EHCI_HCD, CONFIG_USB_OHCI_HCD, (CONFIG_HID_GENERIC, CONFIG_USB_HID, CONFIG_USB_SUPPORT, CONFIG_USB_XHCI_HCD, CONFIG_USB_EHCI_HCD, CONFIG_USB_OHCI_HCD, CONFIG_USB4)</span><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>Device<span class="w"> </span>Drivers<span class="w"> </span>---&gt;
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">  </span>HID<span class="w"> </span>support<span class="w">  </span>---&gt;
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">    </span>-*-<span class="w"> </span>HID<span class="w"> </span>bus<span class="w"> </span>support
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span>&lt;*&gt;<span class="w">   </span>Generic<span class="w"> </span>HID<span class="w"> </span>driver
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">    </span><span class="o">[</span>*<span class="o">]</span><span class="w">   </span>Battery<span class="w"> </span>level<span class="w"> </span>reporting<span class="w"> </span><span class="k">for</span><span class="w"> </span>HID<span class="w"> </span>devices
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">      </span>USB<span class="w"> </span>HID<span class="w"> </span>support<span class="w">  </span>---&gt;
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">        </span>&lt;*&gt;<span class="w"> </span>USB<span class="w"> </span>HID<span class="w"> </span>transport<span class="w"> </span>layer
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">  </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>USB<span class="w"> </span>support<span class="w">  </span>---&gt;
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">    </span>&lt;*&gt;<span class="w">     </span>xHCI<span class="w"> </span>HCD<span class="w"> </span><span class="o">(</span>USB<span class="w"> </span><span class="m">3</span>.0<span class="o">)</span><span class="w"> </span>support
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">    </span>&lt;*&gt;<span class="w">     </span>EHCI<span class="w"> </span>HCD<span class="w"> </span><span class="o">(</span>USB<span class="w"> </span><span class="m">2</span>.0<span class="o">)</span><span class="w"> </span>support
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">    </span>&lt;*&gt;<span class="w">     </span>OHCI<span class="w"> </span>HCD<span class="w"> </span><span class="o">(</span>USB<span class="w"> </span><span class="m">1</span>.1<span class="o">)</span><span class="w"> </span>support
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">  </span>&lt;*&gt;<span class="w"> </span>Unified<span class="w"> </span>support<span class="w"> </span><span class="k">for</span><span class="w"> </span>USB4<span class="w"> </span>and<span class="w"> </span>Thunderbolt<span class="w">  </span>---&gt;
</code></pre></div>
<h4 id="architecture-specific-kernel-configuration">Architecture specific kernel configuration</h4>
<p>Make sure to select IA32 Emulation if 32-bit programs should be supported (<em>CONFIG_IA32_EMULATION</em>). Gentoo installs a multilib system (mixed 32-bit/64-bit computing) by default, so unless a no-multilib profile is used, this option is required.</p>
<div class="highlight"><span class="filename">KERNEL Selecting processor types and features</span><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>Processor<span class="w"> </span><span class="nb">type</span><span class="w"> </span>and<span class="w"> </span>features<span class="w">  </span>---&gt;
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">   </span><span class="o">[</span><span class="w"> </span><span class="o">]</span><span class="w"> </span>Machine<span class="w"> </span>Check<span class="w"> </span>/<span class="w"> </span>overheating<span class="w"> </span>reporting<span class="w"> </span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">   </span><span class="o">[</span><span class="w"> </span><span class="o">]</span><span class="w">   </span>Intel<span class="w"> </span>MCE<span class="w"> </span>Features
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">   </span><span class="o">[</span><span class="w"> </span><span class="o">]</span><span class="w">   </span>AMD<span class="w"> </span>MCE<span class="w"> </span>Features
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">   </span>Processor<span class="w"> </span>family<span class="w"> </span><span class="o">(</span>AMD-Opteron/Athlon64<span class="o">)</span><span class="w">  </span>---&gt;
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">      </span><span class="o">(</span><span class="w"> </span><span class="o">)</span><span class="w"> </span>Opteron/Athlon64/Hammer/K8
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">      </span><span class="o">(</span><span class="w"> </span><span class="o">)</span><span class="w"> </span>Intel<span class="w"> </span>P4<span class="w"> </span>/<span class="w"> </span>older<span class="w"> </span>Netburst<span class="w"> </span>based<span class="w"> </span>Xeon
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">      </span><span class="o">(</span><span class="w"> </span><span class="o">)</span><span class="w"> </span>Core<span class="w"> </span><span class="m">2</span>/newer<span class="w"> </span>Xeon
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">      </span><span class="o">(</span><span class="w"> </span><span class="o">)</span><span class="w"> </span>Intel<span class="w"> </span>Atom
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">      </span><span class="o">(</span><span class="w"> </span><span class="o">)</span><span class="w"> </span>Generic-x86-64
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>Binary<span class="w"> </span>Emulations<span class="w"> </span>---&gt;
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">   </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>IA32<span class="w"> </span>Emulation
</code></pre></div>
<p>Enable GPT partition label support if that was used previously when partitioning the disk (<em>CONFIG_PARTITION_ADVANCED</em> and <em>CONFIG_EFI_PARTITION</em>):</p>
<div class="highlight"><span class="filename">KERNEL Enable support for GPT</span><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>-*-<span class="w"> </span>Enable<span class="w"> </span>the<span class="w"> </span>block<span class="w"> </span>layer<span class="w"> </span>---&gt;
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">   </span>Partition<span class="w"> </span>Types<span class="w"> </span>---&gt;
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">      </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Advanced<span class="w"> </span>partition<span class="w"> </span>selection
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">      </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>EFI<span class="w"> </span>GUID<span class="w"> </span>Partition<span class="w"> </span>support
</code></pre></div>
<p>Enable EFI stub support, EFI variables and EFI Framebuffer in the Linux kernel if UEFI is used to boot the system (<em>CONFIG_EFI</em>, <em>CONFIG_EFI_STUB</em>, <em>CONFIG_EFI_MIXED</em>, <em>CONFIG_EFI_VARS</em>, and <em>CONFIG_FB_EFI</em>):</p>
<div class="highlight"><span class="filename">KERNEL Enable support for UEFI</span><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>Processor<span class="w"> </span><span class="nb">type</span><span class="w"> </span>and<span class="w"> </span>features<span class="w">  </span>---&gt;
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">    </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>EFI<span class="w"> </span>runtime<span class="w"> </span>service<span class="w"> </span>support<span class="w"> </span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">    </span><span class="o">[</span>*<span class="o">]</span><span class="w">   </span>EFI<span class="w"> </span>stub<span class="w"> </span>support
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">    </span><span class="o">[</span>*<span class="o">]</span><span class="w">     </span>EFI<span class="w"> </span>mixed-mode<span class="w"> </span>support
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>Device<span class="w"> </span>Drivers
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">    </span>Firmware<span class="w"> </span>Drivers<span class="w">  </span>---&gt;
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">        </span>EFI<span class="w"> </span><span class="o">(</span>Extensible<span class="w"> </span>Firmware<span class="w"> </span>Interface<span class="o">)</span><span class="w"> </span>Support<span class="w">  </span>---&gt;
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">            </span>&lt;*&gt;<span class="w"> </span>EFI<span class="w"> </span>Variable<span class="w"> </span>Support<span class="w"> </span>via<span class="w"> </span>sysfs
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">    </span>Graphics<span class="w"> </span>support<span class="w">  </span>---&gt;
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">        </span>Frame<span class="w"> </span>buffer<span class="w"> </span>Devices<span class="w">  </span>---&gt;
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">            </span>&lt;*&gt;<span class="w"> </span>Support<span class="w"> </span><span class="k">for</span><span class="w"> </span>frame<span class="w"> </span>buffer<span class="w"> </span>devices<span class="w">  </span>---&gt;
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">                </span><span class="o">[</span>*<span class="o">]</span><span class="w">   </span>EFI-based<span class="w"> </span>Framebuffer<span class="w"> </span>Support
</code></pre></div>
<h4 id="compiling-and-installing">Compiling and installing</h4>
<p>With the configuration now done, it is time to compile and install the kernel. Exit the configuration and start the compilation process:</p>
<p><code>root # make &amp;&amp; make modules_install</code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>It is possible to enable parallel builds using <strong>make -jX</strong> with <code>X</code> being an integer number of parallel tasks that the build process is allowed to launch. This is similar to the instructions about /etc/portage/make.conf earlier, with the <em>MAKEOPTS</em> variable.</p>
<p>When the kernel has finished compiling, copy the kernel image to /boot/. This is handled by the make install command:</p>
<p><code>root # make install</code></p>
<p>This will copy the kernel image into /boot/ together with the System.map file and the kernel configuration file.</p>
<h4 id="optional-building-an-initramfs">Optional: Building an initramfs</h4>
<p>In certain cases it is necessary to build an initramfs - an initial <strong>ram</strong>-based <strong>f</strong>ile <strong>s</strong>ystem. The most common reason is when important file system locations (like /usr/ or /var/) are on separate partitions. With an initramfs, these partitions can be mounted using the tools available inside the initramfs.</p>
<p>Without an initramfs, there is a risk that the system will not boot properly as the tools that are responsible for mounting the file systems require information that resides on unmounted file systems. An initramfs will pull in the necessary files into an archive which is used right after the kernel boots, but before the control is handed over to the init tool. Scripts on the initramfs will then make sure that the partitions are properly mounted before the system continues booting.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
</div>
<p>If using genkernel, it should be used for both building the kernel and the initramfs. When using genkernel only for generating an initramfs, it is crucial to pass <code>--kernel-config=/path/to/kernel.config</code> to genkernel or the generated initramfs may not work with a manually built kernel. Note that manually built kernels go beyond the scope of support for the handbook. See the kernel configuration article for more information.</p>
<p>To install an initramfs, install <a href="https://packages.gentoo.org/packages/sys-kernel/dracut">sys-kernel/dracut</a> first, then have it generate an initramfs:</p>
<p><code>root # emerge --ask sys-kernel/dracut</code></p>
<p><code>root # dracut --kver=5.15.52-gentoo</code></p>
<p>The initramfs will be stored in /boot/. The resulting file can be found by simply listing the files starting with initramfs:</p>
<p><code>root # ls /boot/initramfs*</code></p>
<p>Now continue with <a href="#kernel-modules">Kernel modules</a>.</p>
<h2 id="kernel-modules">Kernel modules</h2>
<h3 id="listing-available-kernel-modules">Listing available kernel modules</h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>Hardware modules are optional to be listed manually. udev will normally load all hardware modules that are detected to be connected in most cases. However, it is not harmful for modules that will be automatically loaded to be listed. Modules cannot be loaded twice; they are either loaded or unloaded. Sometimes exotic hardware requires help to load their drivers.</p>
<p>The modules that need to be loaded during each boot in can be added to <code>/etc/modules-load.d/*.conf</code> files in the format of one module per line. When extra options are needed for the modules, they should be set in <code>/etc/modprobe.d/*.conf</code> files instead.</p>
<p>To view all modules available for a specific kernel version, issue the following <strong>find</strong> command. Do not forget to substitute "<kernel version>" with the appropriate version of the kernel to search:</p>
<p><code>root # find /lib/modules/&lt;kernel version&gt;/ -type f -iname '*.o' -or -iname '*.ko' | less</code></p>
<h3 id="force-loading-particular-kernel-modules">Force loading particular kernel modules</h3>
<p>To force load the kernel to load the 3c59x.ko module (which is the driver for a specific 3Com network card family), edit the /etc/modules-load.d/network.conf file and enter the module name within it.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>root<span class="w"> </span><span class="c1">#mkdir -p /etc/modules-load.d</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>root<span class="w"> </span><span class="c1">#nano -w /etc/modules-load.d/network.conf</span>
</code></pre></div>
<p>Note that the module's .ko file suffix is insignificant to the loading mechanism and left out of the configuration file:</p>
<div class="highlight"><span class="filename">FILE /etc/modules-load.d/network.confForce loading 3c59x module</span><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>3c59x
</code></pre></div>
<p>Continue the installation with <a href="../08-Configuring%20the%20system/">Configuring the system</a>.</p>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2023 <a href="https://github.com/floviken"  target="_blank" rel="noopener">kaboli</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/floviken" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tracking", "navigation.sections", "navigation.sections", "navigation.expand", "navigation.top", "toc.integrate", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>